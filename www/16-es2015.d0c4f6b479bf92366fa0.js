(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{nLhO:function(e,i,o){"use strict";o.r(i),o.d(i,"UsuariosPageModule",(function(){return K}));var t=o("ofXK"),s=o("3Pt+"),n=o("TEn/"),r=o("tyNb"),a=o("mrSG"),l=o("AytR"),c=o("fXoL"),d=o("IrbQ"),u=o("on2l");let b=(()=>{class e{constructor(e,i,o,t,s,n,r){this.formBuilder=e,this.modalController=i,this.alertController=o,this.toastController=t,this.actionSheetController=s,this.hardwarecontrollerService=n,this.usuarioService=r,this.baseUrl=l.a.baseUrl,this.noImage="noImage.svg",this.userRole="USER_ROLE",this.userRoleStyle="avatarBtn"}ngOnInit(){"ADMIN_ROLE"===this.usuario.role&&(this.userRoleStyle="avatarBtn_Admin"),console.log(this.usuario),this.userData=this.formBuilder.group({nombre:[this.usuario.nombre,[s.j.required,s.j.minLength(3)]],email:[this.usuario.email,[s.j.required,s.j.email]]})}cerrarModal(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.alertController.create({backdropDismiss:!1,header:"\xa1Hey!",message:"No se han guardado los cambios. \xbfQuieres continuar?.",buttons:[{text:"S\xed",cssClass:"confirm",handler:()=>{this.modalController.dismiss({dismissed:!0})}},{text:"No",cssClass:"cancel"}]});yield e.present()}))}actualizarDatos(){console.log("Funciona Actualizar Usuario"),console.log(this.userData.value),this.usuarioService.actualizarPerfil_ext({nombre:this.userData.value.nombre,email:this.userData.value.email,role:this.usuario.role},this.usuario.userID).then(e=>Object(a.a)(this,void 0,void 0,(function*(){console.log(e),e&&((yield this.toastController.create({header:"Se ha actualizado el usuario correctamente",position:"bottom"})).present(),setTimeout(()=>{this.toastController.dismiss()},5e3),this.modalController.dismiss({itemReturned:e}))})))}changeProperties(){return Object(a.a)(this,void 0,void 0,(function*(){console.log("Cambiando las propiedades");const e=yield this.actionSheetController.create({header:"Escoge una acci\xf3n:",buttons:[{text:"Cambiar imagen desde c\xe1mara",icon:"camera-outline",handler:()=>{console.log("Camara en funci\xf3n"),this.hardwarecontrollerService.openCamera()}},{text:"Cambiar imagen desde galer\xeda",icon:"image-outline",handler:()=>{console.log("Galer\xeda abierta"),this.hardwarecontrollerService.openGalery()}},{text:"Cancelar",icon:"close",role:"cancel",handler:()=>{console.log("Cancelado")}}]});yield e.present()}))}}return e.\u0275fac=function(i){return new(i||e)(c.Ib(s.a),c.Ib(n.U),c.Ib(n.b),c.Ib(n.cb),c.Ib(n.a),c.Ib(d.a),c.Ib(u.a))},e.\u0275cmp=c.Cb({type:e,selectors:[["app-editar-usuario"]],inputs:{usuario:"usuario"},decls:34,vars:7,consts:[["slot","end"],["color","danger",3,"click"],["slot","icon-only","name","close-outline","color","dark"],[1,"ion-padding"],[1,"ion-padding","ion-text-center"],["fixed",""],["size","4",1,"ion-align-self-center"],[3,"src","click"],["size","8",1,"ion-align-self-center","ion-text-start","ion-padding-start"],[1,"ion-no-margin"],[2,"font-weight","300","font-size","10px"],[1,"ion-padding","ion-margin-top"],[3,"formGroup"],["slot","start","name","person-circle-outline","color","secondary"],["position","stacked","color","primary",2,"opacity","0.6"],["type","text","formControlName","nombre"],[2,"padding-top","20px"],["slot","start","name","at-outline","color","secondary"],["type","email","formControlName","email"],[1,"ion-text-center"],["color","tertiary","fill","outline","shape","round",1,"ion-padding",3,"click"],["slot","start","name","save-outline"]],template:function(e,i){1&e&&(c.Lb(0,"ion-header"),c.Lb(1,"ion-toolbar"),c.Lb(2,"ion-title"),c.fc(3,"Modifica a un usuario"),c.Kb(),c.Lb(4,"ion-buttons",0),c.Lb(5,"ion-button",1),c.Tb("click",(function(){return i.cerrarModal()})),c.Jb(6,"ion-icon",2),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Lb(7,"ion-content",3),c.Lb(8,"div",4),c.Lb(9,"ion-grid",5),c.Lb(10,"ion-row"),c.Lb(11,"ion-col",6),c.Lb(12,"img",7),c.Tb("click",(function(){return i.changeProperties()})),c.Kb(),c.Kb(),c.Lb(13,"ion-col",8),c.Lb(14,"h1",9),c.fc(15),c.Kb(),c.Lb(16,"ion-text",10),c.fc(17),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Lb(18,"div",11),c.Lb(19,"form",12),c.Lb(20,"ion-item"),c.Jb(21,"ion-icon",13),c.Lb(22,"ion-label",14),c.fc(23,"Nombre:"),c.Kb(),c.Jb(24,"ion-input",15),c.Kb(),c.Lb(25,"ion-item",16),c.Jb(26,"ion-icon",17),c.Lb(27,"ion-label",14),c.fc(28,"Email:"),c.Kb(),c.Jb(29,"ion-input",18),c.Kb(),c.Kb(),c.Kb(),c.Lb(30,"div",19),c.Lb(31,"ion-button",20),c.Tb("click",(function(){return i.actualizarDatos()})),c.Jb(32,"ion-icon",21),c.fc(33," Guardar "),c.Kb(),c.Kb(),c.Kb()),2&e&&(c.xb(12),c.zb(i.userRoleStyle),c.Zb("src","",i.baseUrl,"/upload/users/",i.usuario.img||i.noImage,"",c.cc),c.xb(3),c.gc(i.usuario.nombre),c.xb(2),c.gc(i.usuario.userID),c.xb(2),c.Yb("formGroup",i.userData))},directives:[n.s,n.Q,n.P,n.j,n.i,n.t,n.q,n.r,n.K,n.p,n.O,s.k,s.h,s.c,n.y,n.C,n.x,n.bb,s.g,s.b],styles:[".btnChangeImg[_ngcontent-%COMP%]{display:flex;justify-content:center;cursor:pointer;color:var(--ion-color-medium-tint);font-weight:500;transition:.1s ease}.btnChangeImg[_ngcontent-%COMP%]:active, .btnChangeImg[_ngcontent-%COMP%]:hover{color:var(--ion-color-dark-tint)}.avatarBtn[_ngcontent-%COMP%]{border-radius:100%;max-width:100%;box-shadow:0 0 10px 2px rgba(0,0,0,.2)}.avatarBtn_Admin[_ngcontent-%COMP%]{border:5px solid var(--ion-color-warning);border-radius:100%;max-width:100%;box-shadow:0 0 10px 2px rgba(255,196,9,.5)}"]}),e})();var h=o("kZ8S"),m=o("SKeb");function g(e,i){if(1&e){const e=c.Mb();c.Lb(0,"ion-refresher",12),c.Tb("ionRefresh",(function(i){return c.bc(e),c.Vb().actualizarListaUsuarios(i)})),c.Jb(1,"ion-refresher-content"),c.Kb()}}function f(e,i){if(1&e&&(c.Lb(0,"div",13),c.Lb(1,"ion-card"),c.Lb(2,"ion-card-content",14),c.Jb(3,"ion-spinner",15),c.Lb(4,"p",16),c.fc(5),c.Kb(),c.Kb(),c.Kb(),c.Kb()),2&e){const e=c.Vb();c.xb(5),c.gc(e.loaderText_Card)}}function p(e,i){1&e&&c.Jb(0,"ion-icon",27)}function v(e,i){1&e&&c.Jb(0,"ion-icon",28)}function L(e,i){1&e&&c.Jb(0,"ion-icon",29)}function C(e,i){if(1&e){const e=c.Mb();c.Lb(0,"ion-item-options",30),c.Lb(1,"ion-item-option",31),c.Tb("click",(function(){c.bc(e);const i=c.Vb().$implicit;return c.Vb().eliminar(i)})),c.Jb(2,"ion-icon",32),c.Kb(),c.Kb()}}function I(e,i){if(1&e){const e=c.Mb();c.Lb(0,"ion-list"),c.Lb(1,"ion-item-sliding"),c.Lb(2,"ion-item-options",17),c.Lb(3,"ion-item-option",18),c.Tb("click",(function(){c.bc(e);const o=i.$implicit;return c.Vb().editar(o)})),c.Jb(4,"ion-icon",19),c.Kb(),c.Lb(5,"ion-item-option",20),c.Tb("click",(function(){c.bc(e);const o=i.$implicit;return c.Vb().asignarRol(o)})),c.ec(6,p,1,0,"ion-icon",21),c.ec(7,v,1,0,"ion-icon",22),c.Kb(),c.Kb(),c.Lb(8,"ion-item"),c.Lb(9,"ion-avatar",0),c.Jb(10,"img",23),c.Kb(),c.Lb(11,"ion-label"),c.Lb(12,"h2",24),c.fc(13),c.Kb(),c.Lb(14,"h3"),c.fc(15),c.Kb(),c.Kb(),c.ec(16,L,1,0,"ion-icon",25),c.Kb(),c.ec(17,C,3,0,"ion-item-options",26),c.Kb(),c.Kb()}if(2&e){const e=i.$implicit,o=c.Vb();c.xb(6),c.Yb("ngIf","ADMIN_ROLE"===e.role),c.xb(1),c.Yb("ngIf","USER_ROLE"===e.role),c.xb(3),c.Zb("src","",o.baseUrl,"/upload/users/",e.img||o.noImage,"",c.cc),c.xb(3),c.gc(e.nombre),c.xb(2),c.gc(e.email),c.xb(1),c.Yb("ngIf","ADMIN_ROLE"===e.role),c.xb(1),c.Yb("ngIf","USER_ROLE"===e.role)}}function y(e,i){if(1&e&&(c.Lb(0,"div",16),c.Lb(1,"p",33),c.fc(2),c.Kb(),c.Kb()),2&e){const e=c.Vb();c.xb(2),c.gc(e.listenerText)}}const x=[{path:"",component:(()=>{class e{constructor(e,i,o,t,s,n,r){this.router=e,this.modalController=i,this.alertController=o,this.toastController=t,this.usuarioService=s,this.dataLocalService=n,this.busquedasService=r,this.baseUrl=l.a.baseUrl,this.noImage="noImage.svg",this.usuarios=[],this.totalRegistrados=0,this.desde=0,this.completeListener=!1,this.listenerText="",this.loading=!0,this.updateList=!0,this.loaderText_Card=""}ngOnInit(){this.obtenerUsuarios()}actualizarListaUsuarios(e){return Object(a.a)(this,void 0,void 0,(function*(){this.usuarios=[],this.completeListener=!0,this.listenerText="Actualizando lista de usuarios registrados...",this.desde=0,this.infiniteScroll.disabled=!1,yield this.usuarioService.obtenerUsuarios(this.desde).then(i=>{this.usuarios=i.usuarios,this.totalRegistrados=i.total,!0===i.ok&&(this.completeListener=!1,e.target.complete())})}))}obtenerUsuarios(){return Object(a.a)(this,void 0,void 0,(function*(){this.loaderText_Card="Cargando usuarios registrados...",yield this.usuarioService.obtenerUsuarios(this.desde).then(e=>{this.usuarios=e.usuarios,this.totalRegistrados=e.total,!0===e.ok&&(this.loading=!1)})}))}reloadUsers(e){return Object(a.a)(this,void 0,void 0,(function*(){this.desde+=e,this.desde>=this.totalRegistrados&&(this.desde-=e-10,this.infiniteScroll.disabled=!0,this.completeListener=!0,this.listenerText="Se han mostrado todos los resultados."),yield this.usuarioService.obtenerUsuarios(this.desde).then(e=>{this.usuarios.push(...e.usuarios),this.infiniteScroll.complete()})}))}editar(e){return Object(a.a)(this,void 0,void 0,(function*(){console.log("Usuario seleccionado:",e),this.dataLocalService.cargarToken(),this.usuarioService.getUserData(this.dataLocalService.token).then(i=>Object(a.a)(this,void 0,void 0,(function*(){if(console.log("Usuario en sesi\xf3n",i.user),i.user.userID===e.userID)this.router.navigateByUrl("/dashboard/perfil"),this.ionList.closeSlidingItems();else{this.ionList.closeSlidingItems();const i=yield this.modalController.create({component:b,componentProps:{usuario:e},cssClass:"my-custom-class"});yield i.present();const{data:o}=yield i.onDidDismiss();if(console.log(o),o){const i=o.itemReturned;this.usuarios.find(o=>{if(o.userID===e.userID)return o.nombre=i.nombre,o.email=i.email,!0})||this.usuarios.push(i)}}})))}))}asignarRol(e){return Object(a.a)(this,void 0,void 0,(function*(){if(console.log("Cambiando rol de:",e.nombre),console.log(">> Datos del usuario:",e),"USER_ROLE"===e.role){const i=yield this.alertController.create({backdropDismiss:!1,header:"\xbfHacer administrador?",message:`Estas por asignar el rol de administrador a ${e.nombre}.\n                  \n Si deseas ejecutar la acci\xf3n, presiona 'S\xed'.`,buttons:[{text:"S\xed",cssClass:"confirm",handler:()=>Object(a.a)(this,void 0,void 0,(function*(){this.usuarioService.actualizarPerfil_ext({nombre:e.nombre,email:e.email,role:"ADMIN_ROLE"},e.userID).then(i=>Object(a.a)(this,void 0,void 0,(function*(){console.log(i),i&&((yield this.toastController.create({header:`Ahora ${e.nombre} es administrador.`,position:"bottom"})).present(),setTimeout(()=>{this.toastController.dismiss()},2500),this.ionList.closeSlidingItems())})))}))},{text:"Cancelar",cssClass:"cancel",handler:()=>{console.log("Operaci\xf3n cancelada"),this.ionList.closeSlidingItems()}}]});yield i.present()}else{const i=yield this.alertController.create({backdropDismiss:!1,header:"\xbfRevocar permiso de administrador?",message:`Estas por revocar el rol de administrador a ${e.nombre}, si deseas ejecutar la acci\xf3n, presiona 'S\xed'.`,buttons:[{text:"S\xed",cssClass:"delete",handler:()=>Object(a.a)(this,void 0,void 0,(function*(){this.usuarioService.actualizarPerfil_ext({nombre:e.nombre,email:e.email,role:"USER_ROLE"},e.userID).then(i=>Object(a.a)(this,void 0,void 0,(function*(){console.log(i),i&&((yield this.toastController.create({header:e.nombre+" ya no es administrador.",position:"bottom"})).present(),setTimeout(()=>{this.toastController.dismiss()},2500),this.ionList.closeSlidingItems())})))}))},{text:"Cancelar",cssClass:"cancel",handler:()=>{console.log("Operaci\xf3n cancelada"),this.ionList.closeSlidingItems()}}]});yield i.present()}}))}eliminar(e){return Object(a.a)(this,void 0,void 0,(function*(){console.log("Usuario seleccionado:",e),this.dataLocalService.cargarToken(),this.usuarioService.getUserData(this.dataLocalService.token).then(i=>Object(a.a)(this,void 0,void 0,(function*(){if(console.log("Usuario en sesi\xf3n",i.user),i.user.userID===e.userID){const e=yield this.alertController.create({backdropDismiss:!1,header:"No puedes eliminarte a ti mismo...",message:"Solicita la eliminaci\xf3n de tu cuenta a otro administrador."});yield e.present(),setTimeout(()=>{this.alertController.dismiss()},5e3)}else{const i=yield this.alertController.create({backdropDismiss:!1,header:"\xbfSeguro?",message:`Estas por eliminar a ${e.nombre}, si deseas ejecutar la acci\xf3n, presiona Eliminar.`,buttons:[{text:"Eliminar",cssClass:"delete",handler:()=>Object(a.a)(this,void 0,void 0,(function*(){yield this.usuarioService.eliminarUsuario(e.userID).then(i=>Object(a.a)(this,void 0,void 0,(function*(){if(!0===i.ok){(yield this.toastController.create({header:i.header,position:"bottom"})).present(),setTimeout(()=>{this.toastController.dismiss()},2500);const o=this.usuarios.findIndex(i=>i.userID===e.userID);this.usuarios.splice(o,1),this.ionList.closeSlidingItems()}else(yield this.toastController.create({message:i.msg,position:"bottom"})).present(),setTimeout(()=>{this.toastController.dismiss()},5e3),this.ionList.closeSlidingItems()})))}))},{text:"Cancelar",cssClass:"cancel",handler:()=>{console.log("Operaci\xf3n cancelada"),this.ionList.closeSlidingItems()}}]});yield i.present()}})))}))}busqueda(e){return Object(a.a)(this,void 0,void 0,(function*(){if(this.usuarios=[],this.loading=!0,this.loaderText_Card="Buscando usuarios...",this.completeListener=!1,this.infiniteScroll.disabled=!1,""===e.detail.value&&(this.desde=0,this.obtenerUsuarios(),this.completeListener=!1),void 0===e.detail.value)return console.log("Escribe una letra para buscar uno o m\xe1s usuarios con letra semejante.");yield this.busquedasService.busqueda_Coleccion(e.detail.value,"users").then(e=>{0===e.length?(this.loading=!1,this.completeListener=!0,this.listenerText="No hay resultados con el criterio de b\xfasqueda solicitado."):e.length>0&&(this.loading=!1,this.usuarios=e)})}))}}return e.\u0275fac=function(i){return new(i||e)(c.Ib(r.g),c.Ib(n.U),c.Ib(n.b),c.Ib(n.cb),c.Ib(u.a),c.Ib(h.a),c.Ib(m.a))},e.\u0275cmp=c.Cb({type:e,selectors:[["app-usuarios"]],viewQuery:function(e,i){var o;1&e&&(c.hc(n.v,!0),c.hc(n.D,!0)),2&e&&(c.ac(o=c.Ub())&&(i.infiniteScroll=o.first),c.ac(o=c.Ub())&&(i.ionList=o.first))},decls:19,vars:5,consts:[["slot","start"],["defaultHref","/dashboard"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh",4,"ngIf"],["animated","","placeholder","Busca usuarios...",1,"ion-padding",3,"ionChange"],["color","secondary",2,"font-weight","600","opacity","50%"],["slot","end","color","light"],["class","ion-text-center ion-margin-start ion-margin-end",4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-padding-top",4,"ngIf"],["position","bottom",1,"ion-margin-top",3,"ionInfinite"],["loadingSpinner","crescent","loadingText","Cargando m\xe1s usuarios..."],["slot","fixed",3,"ionRefresh"],[1,"ion-text-center","ion-margin-start","ion-margin-end"],[1,"ion-margin"],["color","primary"],[1,"ion-padding-top"],["side","start"],["color","secondary",3,"click"],["name","pencil-outline","slot","icon-only"],["color","light",3,"click"],["name","star","slot","icon-only","color","warning",4,"ngIf"],["name","star-outline","slot","icon-only","color","warning",4,"ngIf"],[3,"src"],[2,"font-weight","600"],["slot","end","name","star","color","warning",4,"ngIf"],["side","end",4,"ngIf"],["name","star","slot","icon-only","color","warning"],["name","star-outline","slot","icon-only","color","warning"],["slot","end","name","star","color","warning"],["side","end"],["color","danger",3,"click"],["name","trash-bin-outline","slot","icon-only"],[1,"ion-text-center",2,"opacity","50%"]],template:function(e,i){1&e&&(c.Lb(0,"ion-header"),c.Lb(1,"ion-toolbar"),c.Lb(2,"ion-buttons",0),c.Jb(3,"ion-back-button",1),c.Kb(),c.Lb(4,"ion-title"),c.fc(5,"Usuarios Registrados"),c.Kb(),c.Kb(),c.Kb(),c.Lb(6,"ion-content",2),c.ec(7,g,2,0,"ion-refresher",3),c.Lb(8,"ion-searchbar",4),c.Tb("ionChange",(function(e){return i.busqueda(e)})),c.Kb(),c.Lb(9,"ion-item"),c.Lb(10,"ion-label",5),c.fc(11,"Total registrados:"),c.Kb(),c.Lb(12,"ion-badge",6),c.fc(13),c.Kb(),c.Kb(),c.ec(14,f,6,1,"div",7),c.ec(15,I,18,8,"ion-list",8),c.ec(16,y,3,1,"div",9),c.Lb(17,"ion-infinite-scroll",10),c.Tb("ionInfinite",(function(){return i.reloadUsers(10)})),c.Jb(18,"ion-infinite-scroll-content",11),c.Kb(),c.Kb()),2&e&&(c.xb(7),c.Yb("ngIf",!0===i.updateList),c.xb(6),c.gc(i.totalRegistrados),c.xb(1),c.Yb("ngIf",!0===i.loading),c.xb(1),c.Yb("ngForOf",i.usuarios),c.xb(1),c.Yb("ngIf",!0===i.completeListener))},directives:[n.s,n.Q,n.j,n.f,n.g,n.P,n.q,t.i,n.L,n.bb,n.y,n.C,n.h,t.h,n.v,n.w,n.H,n.I,n.k,n.l,n.M,n.D,n.B,n.A,n.z,n.t,n.e],styles:[""]}),e})()}];let S=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(i){return new(i||e)},imports:[[r.i.forChild(x)],r.i]}),e})(),K=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(i){return new(i||e)},imports:[[t.b,s.d,s.i,n.R,S]]}),e})()}}]);